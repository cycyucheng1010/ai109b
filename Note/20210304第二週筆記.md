# 20210304第二週筆記
## 程式
* hillClimbing2r.py
```
import random

def hillClimbing(f, x, y, h=0.01):
    failCount = 0                    # 失敗次數歸零
    while (failCount < 10000):       # 如果失敗次數小於一萬次就繼續執行
        fxy = f(x, y)                # fxy 為目前高度
        dx = random.uniform(-h, h)   # dx 為左右偏移量
        dy = random.uniform(-h, h)   # dy 為前後偏移量
        if f(x+dx, y+dy) >= fxy:     # 如果移動後高度比現在高
            x = x + dx               #   就移過去
            y = y + dy
            print('x={:.3f} y={:.3f} f(x,y)={:.3f}'.format(x, y, fxy))
            failCount = 0            # 失敗次數歸零
        else:                        # 若沒有更高
            failCount = failCount + 1#   那就又失敗一次
    return (x,y,fxy)                 # 結束傳回 （已經失敗超過一萬次了）

def f(x, y):
    return -1 * ( x*x -2*x + y*y +2*y - 8 )

hillClimbing(f, 0, 0)
```
>此版為使用亂數之版本

![函式圖形](https://github.com/cycyucheng1010/ai109b/blob/main/Note/hillclimbing2r.PNG)
* result 
```
PS C:\Users\rick2\ai\02-optimize\01-hillclimbing\03-var2> python hillClimbing2r.py
x=0.008 y=0.007 f(x,y)=8.000
x=0.008 y=0.002 f(x,y)=8.002 
x=0.015 y=0.005 f(x,y)=8.012 
x=0.024 y=0.002 f(x,y)=8.021 
x=0.028 y=-0.004 f(x,y)=8.045
x=0.025 y=-0.012 f(x,y)=8.064
x=0.031 y=-0.009 f(x,y)=8.075
x=0.021 y=-0.019 f(x,y)=8.079
.
.
.
x=0.997 y=-0.999 f(x,y)=10.000
x=0.998 y=-1.000 f(x,y)=10.000
x=0.999 y=-1.000 f(x,y)=10.000
x=0.999 y=-1.000 f(x,y)=10.000
x=1.001 y=-1.000 f(x,y)=10.000
x=1.000 y=-1.000 f(x,y)=10.000
x=1.000 y=-1.000 f(x,y)=10.000
```
----------------------------
* hillClimbing.py
```
def hillClimbing(s, maxGens, maxFails):   # 爬山演算法的主體函數
    print("start: ", s.str())             # 印出初始解
    fails = 0                             # 失敗次數設為 0
    # 當代數 gen<maxGen，且連續失敗次數 fails < maxFails 時，就持續嘗試尋找更好的解。
    for gens in range(maxGens):
        snew = s.neighbor()               #  取得鄰近的解
        sheight = s.height()              #  sheight=目前解的高度
        nheight = snew.height()           #  nheight=鄰近解的高度
        if (nheight >= sheight):          #  如果鄰近解比目前解更好
            print(gens, ':', snew.str())  #    印出新的解
            s = snew                      #    就移動過去
            fails = 0                     #    移動成功，將連續失敗次數歸零
        else:                             #  否則
            fails = fails + 1             #    將連續失敗次數加一
        if (fails >= maxFails):
            break
    print("solution: ", s.str())          #  印出最後找到的那個解
    return s                              #    然後傳回。
```
>s是值, maxGens是最大次數, maxFails是最多錯誤次數
* solution.py
```
class Solution: # 解答的物件模版 (類別)
    def __init__(self, v, step = 0.01):
        self.v = v       # 參數 v 為解答的資料結構
        self.step = step # 每一小步預設走的距離

    # 以下兩個函數至少需要覆蓋掉一個，否則會無窮遞迴
    def height(self): # 爬山演算法的高度函數
        return -1*self.energy()               # 高度 = -1 * 能量

    def energy(self): # 尋找最低點的能量函數
        return -1*self.height()               # 能量 = -1 * 高度
```
>用能量觀點去思考此演算法
* solutionNumber.py
```
from hillClimbing import hillClimbing # 引入解答類別
from solution import Solution
import random

class SolutionNumber(Solution):
    def neighbor(self): # 單變數解答的鄰居函數。
        x = self.v
        dx= self.step               # x:解答 , dx : 移動步伐大小
        xnew = x+dx if random.random() > 0.5 else x-dx # 用亂數決定向左或向右移動
        return SolutionNumber(xnew) # 建立新解答並傳回。

    def energy(self):               # 能量函數
        x = self.v                  # x:解答
        return abs(x*x-4)           # 能量函數為 |x^2-4|

    def str(self): # 將解答轉為字串，以供印出觀察。
        return "energy({:.3f})={:.3f}".format(self.v, self.energy())
```
![abs_x^2-4](https://github.com/cycyucheng1010/ai109b/blob/main/Note/abs_x%5E2-4.PNG)
* hillClimginNumber.py
```
from hillClimbing import hillClimbing # 引入爬山演算法類別
from solutionNumber import SolutionNumber # 引入平方根解答類別

# 執行爬山演算法 (從「解答=0.0」開始尋找, 最多十萬代、失敗一千次就跳出。
hillClimbing(SolutionNumber(0.0), 100000, 1000)
```
* result
```
PS C:\Users\rick2\ai\02-optimize\01-hillclimbing\04-framework> python hillClimbingNumber.py
start:  energy(0.000)=4.000
0 : energy(-0.010)=4.000 
1 : energy(-0.020)=4.000 
6 : energy(-0.030)=3.999 
7 : energy(-0.040)=3.998 
8 : energy(-0.050)=3.998 
10 : energy(-0.060)=3.996
11 : energy(-0.070)=3.995
13 : energy(-0.080)=3.994
18 : energy(-0.090)=3.992
20 : energy(-0.100)=3.990
22 : energy(-0.110)=3.988
23 : energy(-0.120)=3.986
24 : energy(-0.130)=3.983
.
.
.
401 : energy(-1.940)=0.236
403 : energy(-1.950)=0.197
406 : energy(-1.960)=0.158
407 : energy(-1.970)=0.119
408 : energy(-1.980)=0.080
409 : energy(-1.990)=0.040
410 : energy(-2.000)=0.000
solution:  energy(-2.000)=0.000
```
>因亂數決定故可能產生+2及-2兩種可能解
-----------------
```
PS C:\Users\rick2\ai\02-optimize\01-hillclimbing\04-framework> python hillClimbingArray.py
start:  energy([1, 1, 1])=1.000000
2 : energy([1.01, 1, 1])=0.980100
3 : energy([1.01, 0.99, 1])=0.950400
5 : energy([1.01, 0.99, 1.01])=0.920500
6 : energy([1.02, 0.99, 1.01])=0.900800
8 : energy([1.02, 0.99, 1.02])=0.871100
9 : energy([1.03, 0.99, 1.02])=0.851600
11 : energy([1.04, 0.99, 1.02])=0.832300
15 : energy([1.05, 0.99, 1.02])=0.813200
18 : energy([1.05, 0.99, 1.03])=0.783700
19 : energy([1.06, 0.99, 1.03])=0.764800
22 : energy([1.06, 0.98, 1.03])=0.735700
23 : energy([1.07, 0.98, 1.03])=0.717000
24 : energy([1.07, 0.97, 1.03])=0.688500
25 : energy([1.07, 0.97, 1.04])=0.659200
.
.
.
688 : energy([2.000000000000001, 0.49999999999999956, 2.409999999999992])=-2.991900
689 : energy([2.000000000000001, 0.49999999999999956, 2.419999999999992])=-2.993600
701 : energy([2.000000000000001, 0.49999999999999956, 2.4299999999999917])=-2.995100
702 : energy([2.000000000000001, 0.49999999999999956, 2.4399999999999915])=-2.996400
717 : energy([2.000000000000001, 0.49999999999999956, 2.4499999999999913])=-2.997500
722 : energy([2.000000000000001, 0.49999999999999956, 2.459999999999991])=-2.998400
729 : energy([2.000000000000001, 0.49999999999999956, 2.469999999999991])=-2.999100
742 : energy([2.000000000000001, 0.49999999999999956, 2.4799999999999907])=-2.999600
744 : energy([2.000000000000001, 0.49999999999999956, 2.4899999999999904])=-2.999900
746 : energy([2.000000000000001, 0.49999999999999956, 2.4999999999999902])=-3.000000
solution:  energy([2.000000000000001, 0.49999999999999956, 2.4999999999999902])=-3.000000
```
